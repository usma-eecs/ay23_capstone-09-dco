# Capstone: Passive Network Discovery

## Overview
A Network defenders’ visibility of their network is crucial to their success as defenders because responding to threats is highly dependent on their ability to detect these threats in the first place. Security Information and Event (SIEM) tools — like Security Onion, Microsoft Azure Sentinel, Splunk Enterprise Security, or IBM Security QRadar — serve as the ultimate collection source/location for any logs generated by a network. These applications create and process rule-based alerts, and they allow for defenders to organize their network’s log data into meaningful representations. At the United States Military Academy, the EECSNet network is running an instance of Security Onion that is collecting EECSNet logs of any traffic on the network — to include internet traffic, DNS queries and/or DHCP requests. For Security Onion, supports an alerts interface, a hunt interface to focus in on specific threats, a case feature to assign case numbers to alerts, and a PCAP interface that allows a defender to view a full packet capture of any packet collected by Security Onion. This project will deliver a prototype software product the provides passive network analysis capabilities to a defender. This product will integrate with Security Onion in order to increase acceptability into already defined network solutions. The Passive Network Analysis Tool will provide OS fingerprinting capabilities and provide a summary of the services a device tends to use based on historical traffic log data — to include DNS, HTTP/HTTPs, DHCP, and other log data. 

## Members of the team
Cadet Claire Dworsky   
Cadet Michael Grimm   
Cadet Nicholas Liebers - 847-840-9054   
Cadet Kevin Ruthemeyer   
Cadet Alicia Torres   

## Instructors
LTC Christopher Morrell   

## Advisors
MAJ John Fernandes   

## Product Owners
Dr. Suzanne Matthews 

<details>
<summary>Important Links</summary>     
https://securityonionsolutions.com/      
  
https://docs.securityonion.net/en/2.3/introduction.html  
</details>




# Installation Build Guide:
## Security Onion Scripts
The Zeek scripts that are of interest of located at https://github.com/usma-eecs/ay23_capstone-09-dco/blob/main/Zeek/http/httpOSDetection.zeek.
For guidance on how to install this script into the Security Onion Environment, use the instructions located below: https://docs.securityonion.net/en/2.3/zeek.html#custom-scripts
This script will run automatically, but data ingestion into the elastic stack is not provided by default since a new logtype is created. Below is the guidance to integrate the new script to Security Onion.

## Security Onion Configuration

## Post-processing
*	GitHub: https://github.com/usma-eecs/ay23_capstone-09-dco/
*	First, in order to get yourself familiarized with a pandas dataframe and the framework laid out by ElasticSearch check out SecurityOnion.ipynb  in the python folder of the GitHub repository it is a Jupyter notebook that will help you understand the data that is being parsed later.
*	Have an account created on seconion.eecs.net by your advisor with superadmin privileges.
    *	This is important as the scripts will not work without high enough privileges as it requires you to be able to upload the dataframe created by the script to ElasticSearch.
*	Create a Virtual Machine so that you have a device that is constantly running.
    *	The script will continually be run so you need an environment that will not be shut down.
*	On the VM, pull the script v3ip_subnet.py from the python folder on the GitHub.
    *	This is the main script for taking ingested data from the Zeek scripts where it is parsed and reformatted to fit the specifications required to create the Kibana dashboards.
*	From the GitHub, in the same directory as the v3ip_subnet.py script pull the Network_Configuration.csv
    *	Without this csv file the subnet mapping will not work.
*	Create a CronJob by using the command ```crontab –e```
    *	In the editor insert ``` 0 0 * * * [full path to python on machine] [full path to v3ip_subnet.py]” (ex. “0 0 * * * /usr/bin/python3 /home/admin/ay23_capstone-09-dco/v3ip_subnet.py”)```
    *	It is crucial to make sure you insert a full path (ex.  ```/home/admin/scripts/v3ip_subnet.py```) as cronjobs will not work otherwise.
*	At the conclusion of all these steps, the post-processing should be functional as long as the scripts on the Salt Stack are done correctly.


## Kibana Dashboard
*	On Kibana, which can be accessed through seconion.eecs.net, simply look for the index called “results”.
*	Create a new dashboard using the “results” index and then you can access a devices IP, OS type, and subnet.
*	With that you should be able to display the data in any format you wish.


### Sprints    

<details>

<summary>Sprint 2</summary>

# Sprint 2 Accomplishments  

## Elastic Search   
We have succeeded in dynamically querying ElasticSearch for post processing and then we can return post process data to ElasticSearch. The presets to query this data are: metadata, log, destination, source, and network.    

## Zeek   
We have a successful theoretical configure file to be pushed up to Zeek (see the local.zeek file). This Zeek file can start ingesting software data.    

</details>

<details>

<summary>Sprint 3 </summary>

# Sprint 3 Accomplishments 

## Meeting with our Security Onion Contact   
We met with Mr. Di Giorgio via Teams to ask his professional guidance on how to edit Zeek via the Salt stack.

</details>

<details>

<summary>Sprint 4</summary>

# Sprint 4 Accomplishments 

## Sprint 4 Feedback 
-How was capacity calculated?  
-Include sprint goal completion percentage   
-Potential pie chart for types of OS 

</details>


### CDR & FDR
<details>

<summary>Final Design Review (FDR)</summary>

## FDR Report Feedback 
Block diagram, missing parallel work emphasis, conclusions, explain diagram better (specifically answer the question regarding the design of our contribution to the system), and fix SIEM misspelling on quad chart

## FDR Presentation Feedback  
-Create different length pitches about the project for Projects Day depending on the audience    
-Ensure all group members know it    
-Explain the purpose of passive network discovery (reduces network on a traffic/stealth)    
-Explain why our project is important    
-Know our audience we are presenting to    

</details>

